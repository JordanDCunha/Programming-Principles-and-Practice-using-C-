/**
 * SECTION 9.5: READING A SINGLE VALUE
 * --- THEORY PART ---
 * [1] THE THREE CHALLENGES: Robust input must handle:
 * - Out-of-range values (e.g., entering 11 when expecting 1-10).
 * - Wrong types (e.g., entering 'abc' when expecting an int).
 * - End-of-file (EOF) (e.g., user closing the stream).
 * [2] SEPARATION OF CONCERNS: Don't mix logic (checking ranges) with
 * mechanics (clearing stream errors) and UI (printing messages).
 * [3] STUBBORNNESS: A good input utility should keep asking until it 
 * gets what it needs or encounters a truly fatal error.
 */

#include <iostream>
#include <string>
#include <vector>

using namespace std;

// Standard error helper
void error(string s) { throw runtime_error(s); }

//------------------------------------------------------------------------------
// 9.5.1: UTILITY - SKIP TO INTEGER
//------------------------------------------------------------------------------

/**
 * If the stream is in a 'fail' state, this skips the "junk" characters
 * until it finds a digit or a minus sign, then puts it back so 
 * it can be read as an int.
 */
void skip_to_int() {
    if (cin.fail()) {            // We found something that wasn't an integer
        cin.clear();             // Reset state to look at the characters
        for (char ch; cin >> ch; ) { 
            if (isdigit(ch) || ch == '-') {
                cin.unget();     // Put the digit/sign back
                return;
            }
        }
    }
    error("no input");           // If we hit EOF or 'bad' state
}



//------------------------------------------------------------------------------
// 9.5.2: ROBUST INPUT FUNCTIONS
//------------------------------------------------------------------------------

/**
 * General purpose: Get any valid integer.
 */
int get_int() {
    int n = 0;
    while (true) {
        if (cin >> n) return n;
        cout << "Sorry, that was not a number; please try again\n";
        skip_to_int();
    }
}

/**
 * Range specific: Get an integer within [low:high].
 * Separates the dialog from the logic (Section 9.5.2).
 */
int get_int(int low, int high, const string& greeting, const string& sorry) {
    cout << greeting << " [" << low << ':' << high << "]: ";

    while (true) {
        int n = get_int(); // Use our general integer reader
        if (low <= n && n <= high) return n;
        cout << sorry << " [" << low << ':' << high << "]: ";
    }
}

//------------------------------------------------------------------------------
// MAIN DEMONSTRATION
//------------------------------------------------------------------------------

int main() {
    try {
        // Professional usage example
        int strength = get_int(1, 10, "Enter strength", "Not in range, try again");
        cout << "Strength set to: " << strength << "\n\n";

        int altitude = get_int(0, 50000, "Please enter altitude in feet", "Invalid altitude");
        cout << "Altitude set to: " << altitude << "ft above sea level\n";

    } catch (exception& e) {
        cerr << "Fatal error: " << e.what() << endl;
        return 1;
    }
    return 0;
}
